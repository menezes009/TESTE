<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teste de Câmera (iOS)</title>
<style>
  body { font-family: -apple-system, system-ui, Segoe UI, Roboto; background:#0b0f14; color:#e5e7eb; margin:0; padding:16px; }
  button { padding:10px 14px; border:1px solid #374151; background:#1f2937; color:#e5e7eb; border-radius:12px; }
  video { width:100%; max-width:420px; background:black; border-radius:12px; margin-top:12px; }
  .ok{color:#16a34a;} .err{color:#ef4444;} .warn{color:#f59e0b;}
  pre{background:#111827; padding:8px; border-radius:8px; overflow:auto;}
</style>
</head>
<body>
<h1>Teste de Câmera (iPhone)</h1>
<p>Abra este link no <strong>Safari</strong> (não Instagram/WhatsApp). Toque no botão abaixo e permita a câmera.</p>
<button id="btn">Iniciar câmera</button>
<div id="status">Aguardando…</div>
<video id="v" playsinline muted></video>
<pre id="log"></pre>
<script>
const v = document.getElementById('v');
const statusEl = document.getElementById('status');
const logEl = document.getElementById('log');
function s(t, cls=''){ statusEl.textContent=t; statusEl.className=cls; }
function log(o){ logEl.textContent += (typeof o==='string'?o:JSON.stringify(o,null,2)) + "\n"; }
document.getElementById('btn').addEventListener('click', async () => {
  try{
    s('Solicitando câmera…');
    const constraints = { video: { facingMode: { exact: 'environment' } }, audio:false };
    const stream = await navigator.mediaDevices.getUserMedia(constraints).catch(async (e)=>{
      // fallback sem exact
      return navigator.mediaDevices.getUserMedia({ video:{ facingMode: 'environment' }, audio:false });
    });
    v.srcObject = stream; await v.play();
    s('Câmera OK ✔', 'ok');
    const devices = await navigator.mediaDevices.enumerateDevices();
    log({devices});
  }catch(e){
    s('Falha: '+ (e.name || '') + ' - ' + (e.message || e), 'err');
    log(e);
    log('Dicas: 1) Safari > AA > Website Settings > Camera: Allow; 2) Ajustes > Safari > Câmera: Permitir; 3) Abra no Safari (não app).');
  }
});
</script>
</body>
</html>
